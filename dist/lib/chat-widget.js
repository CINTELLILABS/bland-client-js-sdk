!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.BlandChatWidget=t():e.BlandChatWidget=t()}(this,(()=>(()=>{"use strict";var e={d:(t,n)=>{for(var a in n)e.o(n,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:n[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},t={};e.d(t,{default:()=>c});var n=function(){return n=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},n.apply(this,arguments)},a=function(e,t,n,a){return new(n||(n=Promise))((function(i,s){function o(e){try{l(a.next(e))}catch(e){s(e)}}function r(e){try{l(a.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,r)}l((a=a.apply(e,t||[])).next())}))},i=function(e,t){var n,a,i,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=r(0),o.throw=r(1),o.return=r(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function r(r){return function(l){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,r[0]&&(s=0)),s;)try{if(n=1,a&&(i=2&r[0]?a.return:r[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,r[1])).done)return i;switch(a=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,a=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==r[0]&&2!==r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=t.call(e,s)}catch(e){r=[6,e],a=0}finally{n=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,l])}}},s=function(){function e(t,a){if(this.widgetElement=null,this.chatElement=null,this.messagesContainer=null,this.isOpen=!1,this.messages=[],this.typingIndicator=null,this.isChatDisabled=!1,this.isExpanded=!1,!(this instanceof e))throw new Error("Class constructor ChatWidget cannot be invoked without 'new'");this.config=n({position:"bottom-right",primaryColor:"#151515",chatTitle:"Chat Support"},t),this.apiService=a}return e.prototype.init=function(){return a(this,void 0,void 0,(function(){var e,t=this;return i(this,(function(n){switch(n.label){case 0:this.createStyles(),this.createWidgetElements(),this.bindEvents(),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.apiService.connectToPathway(this.config.pathwayId,(function(e){return t.handleIncomingMessage(e)}))];case 2:return n.sent(),[3,4];case 3:return e=n.sent(),console.error("Failed to connect to chat service:",e),this.addErrorMessage("Unable to connect to chat service. Please try again later."),[3,4];case 4:return[2]}}))}))},e.prototype.createStyles=function(){var e=document.createElement("style");e.textContent="\n  .bland-chat-widget {\n    position: fixed;\n    z-index: 1000;\n    display: flex;\n    flex-direction: column;\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n  }\n  \n  .bland-chat-widget.bottom-right {\n    bottom: 20px;\n    right: 20px;\n    align-items: flex-end;\n  }\n  \n  .bland-chat-widget.bottom-left {\n    bottom: 20px;\n    left: 20px;\n    align-items: flex-start;\n  }\n  \n  .bland-chat-widget.top-right {\n    top: 20px;\n    right: 20px;\n    align-items: flex-end;\n  }\n  \n  .bland-chat-widget.top-left {\n    top: 20px;\n    left: 20px;\n    align-items: flex-start;\n  }\n  \n  .bland-chat-button {\n    background-color: #151515;\n    color: white;\n    border: none;\n    border-radius: 8px;\n    width: 60px;\n    height: 60px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    cursor: pointer;\n    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);\n    transition: transform 0.3s ease;\n  }\n  \n  .bland-chat-button:hover {\n    transform: scale(1.05);\n    background-color: #333333;\n  }\n  \n  .bland-chat-button svg {\n    width: 24px;\n    height: 27px;\n  }\n  \n  .bland-chat-container {\n    position: absolute;\n    bottom: 80px;\n    width: 350px;\n    height: 500px;\n    background: white;\n    border-radius: 10px;\n    box-shadow: 0 5px 40px rgba(0, 0, 0, 0.16);\n    display: flex;\n    flex-direction: column;\n    overflow: hidden;\n    transition: opacity 0.3s, transform 0.3s, height 0.3s;\n    opacity: 0;\n    transform: translateY(20px) scale(0.95);\n    pointer-events: none;\n    border: 1px solid #e0e0e0;\n  }\n  \n  .bland-chat-container.open {\n    opacity: 1;\n    transform: translateY(0) scale(1);\n    pointer-events: all;\n  }\n  \n  .bland-chat-container.expanded {\n    height: 85vh;\n  }\n  \n  .bland-chat-header {\n    background-color: #151515;\n    color: white;\n    padding: 15px;\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n  }\n  \n  .bland-chat-title {\n    font-weight: bold;\n    font-size: 16px;\n  }\n  \n  .bland-chat-close,\n  .bland-chat-reset {\n    background: none;\n    border: none;\n    color: white;\n    cursor: pointer;\n    padding: 0;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-size: 20px;\n    opacity: 0.8;\n  }\n  \n  .bland-chat-close:hover,\n  .bland-chat-reset:hover {\n    opacity: 1;\n  }\n  \n  .bland-chat-messages {\n    flex: 1;\n    overflow-y: auto;\n    padding: 15px;\n    display: flex;\n    flex-direction: column;\n  }\n  \n  .bland-chat-message {\n    margin-bottom: 10px;\n    max-width: 80%;\n    padding: 10px 15px;\n    border-radius: 8px;\n    line-height: 1.4;\n    font-size: 14px;\n    word-wrap: break-word;\n    transition: opacity 0.2s;\n  }\n  \n  .bland-chat-message.partial {\n    opacity: 0.7;\n  }\n  \n  .bland-chat-message.user {\n    align-self: flex-end;\n    background-color: #151515;\n    color: white;\n    border-bottom-right-radius: 4px;\n  }\n  \n  .bland-chat-message.assistant {\n    align-self: flex-start;\n    background-color: #f0f0f0;\n    color: #151515;\n    border-bottom-left-radius: 4px;\n  }\n  \n  .bland-chat-typing-indicator {\n    display: flex;\n    padding: 10px 15px;\n    background-color: #f0f0f0;\n    border-radius: 8px;\n    border-bottom-left-radius: 4px;\n    margin-bottom: 10px;\n    max-width: 80%;\n    align-self: flex-start;\n  }\n  \n  .bland-chat-typing-indicator span {\n    height: 8px;\n    width: 8px;\n    background-color: #151515;\n    border-radius: 50%;\n    display: inline-block;\n    margin-right: 3px;\n    animation: typing-dot 1.4s infinite;\n  }\n  \n  .bland-chat-typing-indicator span:nth-child(2) {\n    animation-delay: 0.2s;\n  }\n  \n  .bland-chat-typing-indicator span:nth-child(3) {\n    animation-delay: 0.4s;\n    margin-right: 0;\n  }\n  \n  @keyframes typing-dot {\n    0%, 60%, 100% { transform: translateY(0); }\n    30% { transform: translateY(-4px); }\n  }\n  \n  .bland-chat-input-container {\n    padding: 15px;\n    border-top: 1px solid #eaeaea;\n    display: flex;\n  }\n  \n  .bland-chat-input {\n    flex: 1;\n    border: 1px solid #ddd;\n    border-radius: 8px;\n    padding: 10px 15px;\n    font-size: 14px;\n    outline: none;\n    resize: none;\n    font-family: inherit;\n  }\n  \n  .bland-chat-input:focus {\n    border-color: #151515;\n  }\n  \n  .bland-chat-send {\n    background-color: #151515;\n    color: white;\n    border: none;\n    border-radius: 8px;\n    width: 46px;\n    height: 46px;\n    margin-left: 10px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    cursor: pointer;\n  }\n  \n  .bland-chat-send:disabled {\n    background-color: #cccccc;\n    cursor: not-allowed;\n  }\n  \n  .bland-chat-expand {\n    background: none;\n    border: none;\n    color: white;\n    cursor: pointer;\n    padding: 0;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-size: 20px;\n    opacity: 0.8;\n  }\n  \n  .bland-chat-expand:hover {\n    opacity: 1;\n  }\n  \n  @media (max-width: 480px) {\n    .bland-chat-container {\n      width: 100%;\n      height: 100%;\n      bottom: 0;\n      right: 0;\n      border-radius: 0;\n      position: fixed;\n    }\n  }\n",document.head.appendChild(e)},e.prototype.createWidgetElements=function(){this.widgetElement=document.createElement("div"),this.widgetElement.className="bland-chat-widget ".concat(this.config.position);var e=document.createElement("button");e.className="bland-chat-button",e.innerHTML='\n  <svg width="24" height="27" viewBox="0 0 24 27" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path fillRule="evenodd" clipRule="evenodd" d="M17.5996 2.39995H8.23021C8.10222 2.39995 7.99982 2.29755 7.99982 2.16955V0.230395C7.99982 0.102398 7.89742 0 7.76942 0H0.230395C0.102398 0 0 0.102398 0 0.230395V10.1694C0 10.2974 0.102398 10.3998 0.230395 10.3998H23.7691C23.8971 10.3998 23.9995 10.2974 23.9995 10.1694V8.7998C23.9995 5.26548 21.1339 2.39995 17.5996 2.39995ZM0.0303404 18.6303V26.1693C0.0303404 26.2973 0.132738 26.3997 0.260735 26.3997H17.5995C21.1339 26.3997 23.9994 23.5342 23.9994 19.9998V18.6303C23.9994 18.5023 23.897 18.3999 23.769 18.3999H0.260735C0.132738 18.3999 0.0303404 18.5023 0.0303404 18.6303ZM22.5859 15.8646C23.3666 15.8646 24 15.2695 24 14.4505C24 13.6315 23.3666 13.0364 22.5859 13.0364C21.8053 13.0364 21.1718 13.6315 21.1718 14.4505C21.1718 15.2695 21.8053 15.8646 22.5859 15.8646ZM22.5859 13.2988C23.2258 13.2988 23.7057 13.7979 23.7057 14.4505C23.7057 15.1032 23.2258 15.6023 22.5859 15.6023C21.9461 15.6023 21.4662 15.1032 21.4662 14.4505C21.4662 13.7979 21.9461 13.2988 22.5859 13.2988ZM22.3556 15.1864V14.5465H22.5027L22.9059 15.1864H23.2962L22.8803 14.5337C23.117 14.4825 23.2322 14.3034 23.2322 14.1178C23.2322 13.8683 23.0402 13.6955 22.7203 13.6955H22.0037V15.1864H22.3556ZM22.3556 13.945H22.6563C22.7971 13.945 22.8611 14.0218 22.8611 14.1242C22.8611 14.2202 22.7971 14.3034 22.6563 14.3034H22.3556V13.945Z" fill="white"/>\n  </svg>\n',this.chatElement=document.createElement("div"),this.chatElement.className="bland-chat-container";var t=document.createElement("div");t.className="bland-chat-header";var n=document.createElement("div");n.innerHTML='\n  <svg width="120" height="30" viewBox="0 0 576 147" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M574.255 0H532.534C531.826 0 531.259 0.566676 531.259 1.27502V12.0064C531.259 12.7148 530.692 13.2815 529.984 13.2815H478.133C461.788 13.2815 448.046 24.3494 443.955 39.4017H443.938C443.787 39.9418 443.3 40.3491 442.707 40.3491C442.114 40.3491 441.627 39.9507 441.485 39.4017H441.467C437.385 24.3494 423.635 13.2815 407.29 13.2815H345.309C330.372 13.2815 317.604 22.5254 312.398 35.6032C311.884 36.8959 309.954 36.5152 309.945 35.1251L309.892 14.5565C309.892 13.857 309.317 13.2815 308.617 13.2815H212.495C197.566 13.2815 184.807 22.5165 179.592 35.5855C179.078 36.8782 177.148 36.4975 177.139 35.1074L177.077 1.27502C177.077 0.57553 176.502 0 175.802 0H134.072C133.373 0 132.797 0.566676 132.797 1.27502L132.735 35.1074C132.735 36.5063 130.805 36.8871 130.282 35.5855C125.076 22.5165 112.308 13.2815 97.3797 13.2815H45.5289C44.8205 13.2815 44.2539 12.7148 44.2539 12.0064V1.27502C44.2539 0.566676 43.6872 0 42.9788 0H1.27502C0.566676 0 0 0.566676 0 1.27502V56.278C0 56.9864 0.566676 57.553 1.27502 57.553H574.255C574.964 57.553 575.53 56.9864 575.53 56.278V1.27502C575.53 0.566676 574.964 0 574.255 0Z" fill="white"/>\n    <path d="M574.26 101.825H1.44787C0.739528 101.825 0.172852 102.392 0.172852 103.1V144.821C0.172852 145.53 0.739528 146.096 1.44787 146.096H97.4021C112.339 146.096 125.107 136.852 130.314 123.775C130.827 122.482 132.757 122.863 132.766 124.253L132.819 144.83C132.819 145.53 133.395 146.105 134.094 146.105H175.825C176.524 146.105 177.1 145.539 177.1 144.83L177.153 124.253C177.153 122.863 179.092 122.473 179.605 123.775C184.812 136.852 197.58 146.096 212.517 146.096H441.454C442.154 146.096 442.729 145.53 442.729 144.821L442.782 124.253C442.782 122.863 444.721 122.473 445.235 123.775C450.441 136.852 463.209 146.096 478.146 146.096H574.269C574.977 146.096 575.544 145.53 575.544 144.821V103.1C575.544 102.392 574.977 101.825 574.269 101.825H574.26Z" fill="white"/>\n    <path d="M575.532 79.7897C575.532 84.2492 572.083 87.4893 567.832 87.4893C563.582 87.4893 560.133 84.2492 560.133 79.7897C560.133 75.3303 563.582 72.0902 567.832 72.0902C572.083 72.0902 575.532 75.3303 575.532 79.7897ZM573.929 79.7897C573.929 76.2361 571.316 73.5186 567.832 73.5186C564.348 73.5186 561.735 76.2361 561.735 79.7897C561.735 83.3434 564.348 86.0608 567.832 86.0608C571.316 86.0608 573.929 83.3434 573.929 79.7897ZM566.578 80.3123V83.7963H564.662V75.6787H568.564C570.306 75.6787 571.351 76.6193 571.351 77.9781C571.351 78.9884 570.724 79.9639 569.435 80.2426L571.7 83.7963H569.574L567.379 80.3123H566.578ZM568.216 77.0374H566.578V78.9884H568.216C568.982 78.9884 569.33 78.5355 569.33 78.0129C569.33 77.4555 568.982 77.0374 568.216 77.0374Z" fill="white"/>\n  </svg>\n';var a=document.createElement("div");a.style.display="flex",a.style.alignItems="center",a.style.gap="10px";var i=document.createElement("button");i.className="bland-chat-expand",i.innerHTML='\n      <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-maximize-2"><polyline points="15 3 21 3 21 9"/><polyline points="9 21 3 21 3 15"/><line x1="21" x2="14" y1="3" y2="10"/><line x1="3" x2="10" y1="21" y2="14"/></svg>\n    ',i.title="Expand chat",i.style.position="relative",i.style.top="-2px";var s=document.createElement("button");s.className="bland-chat-reset",s.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-rotate-ccw"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>',s.title="Reset chat",s.style.position="relative",s.style.top="-2px";var o=document.createElement("button");o.className="bland-chat-close",o.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>',o.title="Close chat",o.style.position="relative",o.style.top="-2px",a.appendChild(i),a.appendChild(s),a.appendChild(o),t.appendChild(n),t.appendChild(a),this.messagesContainer=document.createElement("div"),this.messagesContainer.className="bland-chat-messages",this.typingIndicator=document.createElement("div"),this.typingIndicator.className="bland-chat-typing-indicator",this.typingIndicator.innerHTML="\n      <span></span>\n      <span></span>\n      <span></span>\n    ",this.typingIndicator.style.display="none";var r=document.createElement("div");r.className="bland-chat-input-container";var l=document.createElement("input");l.className="bland-chat-input",l.type="text",l.placeholder="Type a message...";var c=document.createElement("button");c.className="bland-chat-send",c.innerHTML='\n  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">\n    <path d="M22 2L11 13"></path>\n    <path d="M22 2L15 22L11 13L2 9L22 2Z"></path>\n  </svg>\n',r.appendChild(l),r.appendChild(c),this.chatElement.appendChild(t),this.chatElement.appendChild(this.messagesContainer),this.chatElement.appendChild(r),this.widgetElement.appendChild(this.chatElement),this.widgetElement.appendChild(e),document.body.appendChild(this.widgetElement)},e.prototype.bindEvents=function(){var e=this;if(this.widgetElement){var t=this.widgetElement.querySelector(".bland-chat-button");null==t||t.addEventListener("click",(function(){return e.toggleChat()}));var n=this.widgetElement.querySelector(".bland-chat-close");null==n||n.addEventListener("click",(function(){return e.closeChat()}));var a=this.widgetElement.querySelector(".bland-chat-reset");null==a||a.addEventListener("click",(function(){return e.resetChat()}));var i=this.widgetElement.querySelector(".bland-chat-send");null==i||i.addEventListener("click",(function(){return e.sendMessage()}));var s=this.widgetElement.querySelector(".bland-chat-input");null==s||s.addEventListener("keypress",(function(t){"Enter"===t.key&&(t.preventDefault(),e.sendMessage())})),this.widgetElement.addEventListener("open",(function(){return e.openChat()})),this.widgetElement.addEventListener("close",(function(){return e.closeChat()})),this.widgetElement.addEventListener("reset",(function(){return e.resetChat()}));var o=this.widgetElement.querySelector(".bland-chat-expand");null==o||o.addEventListener("click",(function(){return e.toggleExpand()}))}},e.prototype.toggleChat=function(){this.isOpen?this.closeChat():this.openChat()},e.prototype.openChat=function(){var e;if(this.chatElement){this.chatElement.classList.add("open"),this.isOpen=!0,this.scrollToBottom();var t=null===(e=this.widgetElement)||void 0===e?void 0:e.querySelector(".bland-chat-input");t&&setTimeout((function(){return t.focus()}),300)}},e.prototype.closeChat=function(){this.chatElement&&(this.chatElement.classList.remove("open"),this.isOpen=!1)},e.prototype.resetChat=function(){return a(this,void 0,void 0,(function(){var e,t,n,a,s,o,r=this;return i(this,(function(i){switch(i.label){case 0:this.messages=[],this.messagesContainer&&(this.messagesContainer.innerHTML=""),this.typingIndicator=document.createElement("div"),this.typingIndicator.className="bland-chat-typing-indicator",this.typingIndicator.innerHTML="\n      <span></span>\n      <span></span>\n      <span></span>\n    ",this.typingIndicator.style.display="none",e=this.isChatDisabled,this.isChatDisabled=!1,(t=null===(s=this.widgetElement)||void 0===s?void 0:s.querySelector(".bland-chat-input"))&&(t.disabled=!1,t.placeholder="Type a message..."),(n=null===(o=this.widgetElement)||void 0===o?void 0:o.querySelector(".bland-chat-send"))&&(n.disabled=!1),i.label=1;case 1:return i.trys.push([1,5,,6]),[4,this.apiService.resetChat(this.config.pathwayId)];case 2:return i.sent(),e?[4,this.apiService.connectToPathway(this.config.pathwayId,(function(e){return r.handleIncomingMessage(e)}))]:[3,4];case 3:i.sent(),i.label=4;case 4:return[3,6];case 5:return a=i.sent(),console.error("Error resetting chat:",a),this.addErrorMessage("Failed to reset chat. Please try again."),[3,6];case 6:return[2]}}))}))},e.prototype.addErrorMessage=function(e){var t={id:"error-".concat(Date.now()),text:e,sender:"assistant",timestamp:new Date};this.addMessageToChat(t)},e.prototype.sendMessage=function(){return a(this,void 0,void 0,(function(){var e,t,n,a,s,o,r;return i(this,(function(i){switch(i.label){case 0:if(!(e=null===(o=this.widgetElement)||void 0===o?void 0:o.querySelector(".bland-chat-input"))||!e.value.trim()||this.isChatDisabled)return[2];e.disabled=!0,(t=null===(r=this.widgetElement)||void 0===r?void 0:r.querySelector(".bland-chat-send"))&&(t.disabled=!0),n=e.value.trim(),e.value="",i.label=1;case 1:return i.trys.push([1,3,4,5]),[4,this.apiService.sendMessage(this.config.pathwayId,n)];case 2:return a=i.sent(),this.addMessageToChat(a),this.typingIndicator&&this.messagesContainer&&(this.typingIndicator.parentNode&&this.typingIndicator.parentNode.removeChild(this.typingIndicator),this.messagesContainer.appendChild(this.typingIndicator),this.typingIndicator.style.display="flex",this.scrollToBottom()),[3,5];case 3:return s=i.sent(),console.error("Error sending message:",s),this.typingIndicator&&(this.typingIndicator.style.display="none"),this.addErrorMessage("Sorry, there was an error sending your message. Please try again."),[3,5];case 4:return e.disabled=!1,t&&(t.disabled=!1),e.focus(),[7];case 5:return[2]}}))}))},e.prototype.handleIncomingMessage=function(e){var t,n;if(this.typingIndicator&&(this.typingIndicator.style.display="none"),"assistant"===e.sender&&e.text.toLowerCase().includes("<action"))this.disableChat(e.text);else{if(e.isPartial){var a=this.messages.find((function(t){return t.id===e.id}));if(a){if(a.text=e.text,(i=null===(t=this.messagesContainer)||void 0===t?void 0:t.querySelector('[data-message-id="'.concat(e.id,'"]')))&&(i.textContent=e.text),"assistant"===e.sender&&e.text.includes("<action"))return void this.disableChat(e.text)}else this.addMessageToChat(e)}else{var i,s=this.messages.findIndex((function(t){return t.id===e.id}));s>=0?(this.messages[s]=e,(i=null===(n=this.messagesContainer)||void 0===n?void 0:n.querySelector('[data-message-id="'.concat(e.id,'"]')))&&(i.textContent=e.text,i.classList.remove("partial"))):this.addMessageToChat(e)}this.scrollToBottom()}},e.prototype.disableChat=function(e){var t,n;this.isChatDisabled=!0;var a=null===(t=this.widgetElement)||void 0===t?void 0:t.querySelector(".bland-chat-input");a&&(a.disabled=!0,a.placeholder="Chat disabled. Click 'Reset' to restart.");var i=null===(n=this.widgetElement)||void 0===n?void 0:n.querySelector(".bland-chat-send");i&&(i.disabled=!0);var s={id:"notification-".concat(Date.now()),text:"Chat has ended. Please click the Reset button to restart.",sender:"assistant",timestamp:new Date};this.addMessageToChat(s)},e.prototype.addMessageToChat=function(e){if(this.messages.push(e),this.messagesContainer){var t=document.createElement("div");t.className="bland-chat-message ".concat(e.sender),e.isPartial&&t.classList.add("partial"),t.textContent=e.text,t.setAttribute("data-message-id",e.id),this.messagesContainer.appendChild(t),this.scrollToBottom()}},e.prototype.scrollToBottom=function(){this.messagesContainer&&(this.messagesContainer.scrollTop=this.messagesContainer.scrollHeight)},e.prototype.toggleExpand=function(){var e,t,n;this.chatElement&&(this.isExpanded=!this.isExpanded,this.isExpanded?(this.chatElement.classList.add("expanded"),(n=null===(e=this.widgetElement)||void 0===e?void 0:e.querySelector(".bland-chat-expand"))&&(n.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-minimize-2"><polyline points="4 14 10 14 10 20"/><polyline points="20 10 14 10 14 4"/><line x1="14" x2="21" y1="10" y2="3"/><line x1="3" x2="10" y1="21" y2="14"/></svg>',n.title="Collapse chat")):(this.chatElement.classList.remove("expanded"),(n=null===(t=this.widgetElement)||void 0===t?void 0:t.querySelector(".bland-chat-expand"))&&(n.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-maximize-2"><polyline points="15 3 21 3 21 9"/><polyline points="9 21 3 21 3 15"/><line x1="21" x2="14" y1="3" y2="10"/><line x1="3" x2="10" y1="21" y2="14"/></svg>',n.title="Expand chat")),this.scrollToBottom())},e}(),o=function(e,t,n,a){return new(n||(n=Promise))((function(i,s){function o(e){try{l(a.next(e))}catch(e){s(e)}}function r(e){try{l(a.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,r)}l((a=a.apply(e,t||[])).next())}))},r=function(e,t){var n,a,i,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=r(0),o.throw=r(1),o.return=r(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function r(r){return function(l){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,r[0]&&(s=0)),s;)try{if(n=1,a&&(i=2&r[0]?a.return:r[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,r[1])).done)return i;switch(a=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,a=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==r[0]&&2!==r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=t.call(e,s)}catch(e){r=[6,e],a=0}finally{n=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,l])}}},l=function(){function e(e){this.connections={},this.messageCallbacks={},this.accumulatingMessages={},this.currentMessageIds={},this.config=e}return e.prototype.connectToPathway=function(e,t){var n=this;return new Promise((function(a,i){n.connections[e]&&n.connections[e].close(),n.messageCallbacks[e]=t,n.accumulatingMessages[e]="";var s="wss://stream.aws.dc5.bland.ai/ws/connect/blandshared?pathway_chat=".concat(e),o=new WebSocket(s);o.onopen=function(){console.log("Connected to WebSocket server for pathway: ".concat(e)),n.connections[e]=o;var t={type:"setup",payload:{startNode:"",requestData:[{key:"apiKey",value:n.config.apiKey}],chat_history:[],chatVersion:null}};o.send(JSON.stringify(t)),console.log("Sent setup message to initialize pathway chat"),a()},o.onmessage=function(t){var a=JSON.parse(t.data);if("text"===a.type){n.accumulatingMessages[e]+=a.payload,n.currentMessageIds[e]||(n.currentMessageIds[e]="assistant-".concat(Date.now()));var i={id:n.currentMessageIds[e],text:n.accumulatingMessages[e],sender:"assistant",timestamp:new Date,isPartial:!0};n.messageCallbacks[e]&&n.messageCallbacks[e](i)}else if("callID"===a.type)console.log("Received call ID:",a.payload);else if("done"===a.type){var s={id:n.currentMessageIds[e]||"assistant-".concat(Date.now()),text:n.accumulatingMessages[e],sender:"assistant",timestamp:new Date,isPartial:!1};n.accumulatingMessages[e]="",n.currentMessageIds[e]="",n.messageCallbacks[e]&&n.messageCallbacks[e](s)}else if("error"===a.type){console.error("Error from Assistant:",a.payload);var o={id:"error-".concat(Date.now()),text:"Error: ".concat(a.payload),sender:"assistant",timestamp:new Date};n.messageCallbacks[e]&&n.messageCallbacks[e](o),n.accumulatingMessages[e]="",n.currentMessageIds[e]=""}},o.onclose=function(){console.log("Disconnected from WebSocket server for pathway: ".concat(e)),delete n.connections[e]},o.onerror=function(t){console.error("WebSocket error for pathway ".concat(e,":"),t),i(t)}}))},e.prototype.sendMessage=function(e,t){return o(this,void 0,void 0,(function(){var n,a;return r(this,(function(i){switch(i.label){case 0:return this.connections[e]&&this.connections[e].readyState===WebSocket.OPEN?[3,2]:[4,this.connectToPathway(e,this.messageCallbacks[e]||function(){})];case 1:i.sent(),i.label=2;case 2:if(n={id:"user-".concat(Date.now()),text:t,sender:"user",timestamp:new Date},this.connections[e].readyState!==WebSocket.OPEN)throw console.error("WebSocket is not open. Cannot send message."),new Error("WebSocket connection not available");return a={type:"text",payload:t},this.connections[e].send(JSON.stringify(a)),[2,n]}}))}))},e.prototype.resetChat=function(e){return o(this,void 0,void 0,(function(){return r(this,(function(t){switch(t.label){case 0:return this.connections[e]&&(this.connections[e].close(),delete this.connections[e]),this.accumulatingMessages[e]="",this.currentMessageIds[e]="",this.messageCallbacks[e]?[4,this.connectToPathway(e,this.messageCallbacks[e])]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},e}();!function(){var e=null,t=null;function n(n){n.pathwayId?(t=new l(n),(e=new s(n,t)).init()):console.error("BLAND_CHAT: pathwayId is required")}window.BLAND_CHAT_CONFIG&&n(window.BLAND_CHAT_CONFIG);var a={init:function(e){n(e)},open:function(){null==e||e.openChat()},close:function(){null==e||e.closeChat()},reset:function(){null==e||e.resetChat()}};window.BLAND_CHAT=a}();const c={};return t.default})()));
//# sourceMappingURL=chat-widget.js.map